"use strict";(globalThis.webpackChunkolocus_docs=globalThis.webpackChunkolocus_docs||[]).push([[7913],{1605:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"api/block-operations","title":"Block Operations API","description":"Core APIs for creating, verifying, and managing blocks in the Olocus Protocol.","source":"@site/docs/api/block-operations.md","sourceDirName":"api","slug":"/api/block-operations","permalink":"/docs/api/block-operations","draft":false,"unlisted":false,"editUrl":"https://codeberg.org/olocus/protocol/edit/main/docs/api/block-operations.md","tags":[],"version":"current","lastUpdatedAt":1764941993000,"sidebarPosition":2,"frontMatter":{"id":"block-operations","title":"Block Operations API","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Core API Reference","permalink":"/docs/api/core"},"next":{"title":"Cryptographic Operations","permalink":"/docs/api/cryptographic-operations"}}');var a=i(4848),r=i(8453);const s={id:"block-operations",title:"Block Operations API",sidebar_position:2},o="Block Operations API",t={},c=[{value:"Block Structure",id:"block-structure",level:2},{value:"Creating Blocks",id:"creating-blocks",level:2},{value:"Genesis Block",id:"genesis-block",level:3},{value:"Subsequent Blocks",id:"subsequent-blocks",level:3},{value:"Block Verification",id:"block-verification",level:2},{value:"Single Block Verification",id:"single-block-verification",level:3},{value:"Chain Verification",id:"chain-verification",level:3},{value:"BlockPayload Trait",id:"blockpayload-trait",level:2},{value:"Hash Operations",id:"hash-operations",level:2},{value:"Block Hashing",id:"block-hashing",level:3},{value:"Payload Hashing",id:"payload-hashing",level:3},{value:"Timestamp Handling",id:"timestamp-handling",level:2},{value:"Current Timestamp",id:"current-timestamp",level:3},{value:"Timestamp Validation",id:"timestamp-validation",level:3},{value:"Key Management",id:"key-management",level:2},{value:"Key Generation",id:"key-generation",level:3},{value:"Key Rotation",id:"key-rotation",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Advanced Operations",id:"advanced-operations",level:2},{value:"Batch Operations",id:"batch-operations",level:3},{value:"Parallel Verification",id:"parallel-verification",level:3},{value:"Block Filtering",id:"block-filtering",level:3},{value:"Performance Tips",id:"performance-tips",level:2},{value:"Optimization Strategies",id:"optimization-strategies",level:3},{value:"Benchmarks",id:"benchmarks",level:3},{value:"Code Examples",id:"code-examples",level:2},{value:"Complete Example",id:"complete-example",level:3},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"block-operations-api",children:"Block Operations API"})}),"\n",(0,a.jsx)(n.p,{children:"Core APIs for creating, verifying, and managing blocks in the Olocus Protocol."}),"\n",(0,a.jsx)(n.h2,{id:"block-structure",children:"Block Structure"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"pub struct Block<P: BlockPayload> {\n    pub header: BlockHeader,\n    pub payload: P,\n    pub signature: Signature,\n    pub public_key: VerifyingKey,\n}\n\npub struct BlockHeader {\n    pub version: u16,        // Protocol version (0x0105)\n    pub index: u64,          // Block index in chain\n    pub timestamp: i64,      // Unix timestamp\n    pub previous: [u8; 32],  // Previous block hash\n    pub payload_hash: [u8; 32], // SHA-256 of payload\n    pub payload_type: u32,   // Payload type identifier\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"creating-blocks",children:"Creating Blocks"}),"\n",(0,a.jsx)(n.h3,{id:"genesis-block",children:"Genesis Block"}),"\n",(0,a.jsx)(n.p,{children:"Create the first block in a chain:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"use olocus_core::{Block, generate_key, current_timestamp};\n\n// Generate keypair\nlet (signing_key, verifying_key) = generate_key();\n\n// Create genesis block\nlet genesis = Block::genesis(\n    payload,           // Your payload implementing BlockPayload\n    &signing_key,      // Ed25519 signing key\n    current_timestamp() // Current Unix timestamp\n);\n\n// Genesis block has:\n// - index: 0\n// - previous: [0; 32] (all zeros)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"subsequent-blocks",children:"Subsequent Blocks"}),"\n",(0,a.jsx)(n.p,{children:"Create blocks that follow a genesis or previous block:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"// Create next block\nlet block2 = Block::next(\n    &genesis,          // Previous block reference\n    new_payload,       // New payload\n    &signing_key,      // Same or different key\n    current_timestamp()\n)?;\n\n// Automatically sets:\n// - index: previous.index + 1\n// - previous: hash of previous block\n// - proper chain linking\n"})}),"\n",(0,a.jsx)(n.h2,{id:"block-verification",children:"Block Verification"}),"\n",(0,a.jsx)(n.h3,{id:"single-block-verification",children:"Single Block Verification"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"use olocus_core::verify_block;\n\n// Verify standalone block (e.g., genesis)\nverify_block(&genesis, None)?;\n\n// Verify block in chain\nverify_block(&block2, Some(&genesis))?;\n\n// Verification checks:\n// \u2713 Valid Ed25519 signature\n// \u2713 Correct payload hash\n// \u2713 Valid timestamp (not too old/future)\n// \u2713 Proper chain linking (if previous provided)\n// \u2713 Monotonic index increment\n"})}),"\n",(0,a.jsx)(n.h3,{id:"chain-verification",children:"Chain Verification"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"use olocus_core::verify_chain;\n\nlet chain = vec![genesis, block2, block3];\n\n// Verify entire chain\nverify_chain(&chain)?;\n\n// Checks all blocks plus:\n// \u2713 Continuous hash chain\n// \u2713 Monotonic timestamps\n// \u2713 No gaps in indices\n"})}),"\n",(0,a.jsx)(n.h2,{id:"blockpayload-trait",children:"BlockPayload Trait"}),"\n",(0,a.jsx)(n.p,{children:"Implement this trait for custom payload types:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"use olocus_core::{BlockPayload, Error};\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct MyPayload {\n    pub data: String,\n    pub value: u64,\n}\n\nimpl BlockPayload for MyPayload {\n    fn to_bytes(&self) -> Vec<u8> {\n        // Must be deterministic!\n        serde_json::to_vec(self).unwrap()\n    }\n    \n    fn from_bytes(bytes: &[u8]) -> Result<Self, Error> {\n        serde_json::from_slice(bytes)\n            .map_err(|e| Error::Deserialization(e.to_string()))\n    }\n    \n    fn payload_type() -> u32 {\n        0x8000  // Your unique type (0x8000-0xFFFF for custom)\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"hash-operations",children:"Hash Operations"}),"\n",(0,a.jsx)(n.h3,{id:"block-hashing",children:"Block Hashing"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"// Get block hash (SHA-256)\nlet hash: [u8; 32] = block.hash();\n\n// Hash includes:\n// - All header fields\n// - Payload hash\n// - Public key\n// - Signature\n\n// Used for:\n// - Chain linking (previous field)\n// - Content addressing\n// - Deduplication\n"})}),"\n",(0,a.jsx)(n.h3,{id:"payload-hashing",children:"Payload Hashing"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"// Payload is hashed separately\nlet payload_bytes = payload.to_bytes();\nlet payload_hash = olocus_core::hash(&payload_bytes);\n\n// Enables:\n// - Payload verification without full block\n// - Efficient payload comparison\n// - Merkle tree construction\n"})}),"\n",(0,a.jsx)(n.h2,{id:"timestamp-handling",children:"Timestamp Handling"}),"\n",(0,a.jsx)(n.h3,{id:"current-timestamp",children:"Current Timestamp"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"use olocus_core::current_timestamp;\n\n// Get current Unix timestamp\nlet now: u64 = current_timestamp();\n\n// Used for block creation\nlet block = Block::genesis(payload, &key, now);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"timestamp-validation",children:"Timestamp Validation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"// Constants for validation\npub const MAX_FUTURE_DRIFT: i64 = 300;  // 5 minutes\npub const MAX_BLOCK_AGE: i64 = 86400;   // 24 hours\n\n// Validation rules:\n// - Not more than 5 minutes in future\n// - Not more than 24 hours old\n// - Must be >= previous block timestamp\n"})}),"\n",(0,a.jsx)(n.h2,{id:"key-management",children:"Key Management"}),"\n",(0,a.jsx)(n.h3,{id:"key-generation",children:"Key Generation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"use olocus_core::generate_key;\n\n// Generate Ed25519 keypair\nlet (signing_key, verifying_key) = generate_key();\n\n// signing_key: [u8; 32] - Keep secret!\n// verifying_key: [u8; 32] - Public, share freely\n"})}),"\n",(0,a.jsx)(n.h3,{id:"key-rotation",children:"Key Rotation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"// Blocks can use different keys\nlet block1 = Block::genesis(payload1, &key1, timestamp);\nlet block2 = Block::next(&block1, payload2, &key2, timestamp)?;\n\n// Each block is independently signed\n// Enables key rotation without breaking chain\n"})}),"\n",(0,a.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:'use olocus_core::Error;\n\nmatch verify_block(&block, Some(&previous)) {\n    Ok(()) => println!("Block valid!"),\n    Err(Error::InvalidSignature) => {\n        println!("Signature verification failed");\n    }\n    Err(Error::InvalidPayloadHash) => {\n        println!("Payload hash mismatch");\n    }\n    Err(Error::BrokenChain) => {\n        println!("Chain continuity broken");\n    }\n    Err(Error::InvalidTimestamp { expected, actual }) => {\n        println!("Timestamp issue: expected {}, got {}", expected, actual);\n    }\n    Err(e) => println!("Other error: {}", e),\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"advanced-operations",children:"Advanced Operations"}),"\n",(0,a.jsx)(n.h3,{id:"batch-operations",children:"Batch Operations"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"// Create multiple blocks efficiently\nlet mut blocks = Vec::new();\nlet mut previous = genesis;\n\nfor payload in payloads {\n    let block = Block::next(&previous, payload, &key, current_timestamp())?;\n    blocks.push(block.clone());\n    previous = block;\n}\n\n// Verify batch\nverify_chain(&blocks)?;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"parallel-verification",children:"Parallel Verification"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"use rayon::prelude::*;\n\n// Verify signatures in parallel\nlet results: Vec<_> = blocks\n    .par_iter()\n    .map(|block| block.verify_signature())\n    .collect();\n\n// Check results\nfor result in results {\n    result?;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"block-filtering",children:"Block Filtering"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"// Find blocks by payload type\nlet location_blocks: Vec<_> = chain\n    .iter()\n    .filter(|block| block.header.payload_type == 0x0100)\n    .collect();\n\n// Find blocks by time range\nlet recent: Vec<_> = chain\n    .iter()\n    .filter(|block| {\n        block.header.timestamp > (current_timestamp() - 3600) as i64\n    })\n    .collect();\n"})}),"\n",(0,a.jsx)(n.h2,{id:"performance-tips",children:"Performance Tips"}),"\n",(0,a.jsx)(n.h3,{id:"optimization-strategies",children:"Optimization Strategies"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Batch Operations"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"// Good: Batch verify\nverify_chain(&blocks)?;\n\n// Avoid: Individual verification in loop\nfor block in blocks {\n    verify_block(&block, prev)?;\n}\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Lazy Verification"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"// Verify only when needed\nif untrusted_source {\n    verify_block(&block, None)?;\n}\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Caching Hashes"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"// Cache computed hashes\nlet hash = block.hash();\nhash_cache.insert(block.header.index, hash);\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"benchmarks",children:"Benchmarks"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Operation"}),(0,a.jsx)(n.th,{children:"Time"}),(0,a.jsx)(n.th,{children:"Throughput"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Block creation"}),(0,a.jsx)(n.td,{children:"< 1ms"}),(0,a.jsx)(n.td,{children:"> 1000/sec"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Signature verification"}),(0,a.jsx)(n.td,{children:"< 1ms"}),(0,a.jsx)(n.td,{children:"> 1000/sec"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"SHA-256 hash"}),(0,a.jsx)(n.td,{children:"< 100\u03bcs"}),(0,a.jsx)(n.td,{children:"> 10000/sec"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Chain verify (1000 blocks)"}),(0,a.jsx)(n.td,{children:"< 1s"}),(0,a.jsx)(n.td,{children:"> 1000/sec"})]})]})]}),"\n",(0,a.jsx)(n.h2,{id:"code-examples",children:"Code Examples"}),"\n",(0,a.jsx)(n.h3,{id:"complete-example",children:"Complete Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:'use olocus_core::*;\n\nfn main() -> Result<(), Error> {\n    // 1. Generate keys\n    let (signing_key, verifying_key) = generate_key();\n    \n    // 2. Create payload\n    let payload = MyPayload {\n        data: "Hello Olocus".to_string(),\n        value: 42,\n    };\n    \n    // 3. Create genesis block\n    let genesis = Block::genesis(\n        payload.clone(),\n        &signing_key,\n        current_timestamp()\n    );\n    \n    // 4. Verify genesis\n    verify_block(&genesis, None)?;\n    println!("Genesis hash: {:?}", genesis.hash());\n    \n    // 5. Create next block\n    let payload2 = MyPayload {\n        data: "Second block".to_string(),\n        value: 100,\n    };\n    \n    let block2 = Block::next(\n        &genesis,\n        payload2,\n        &signing_key,\n        current_timestamp()\n    )?;\n    \n    // 6. Verify chain\n    let chain = vec![genesis, block2];\n    verify_chain(&chain)?;\n    \n    println!("Chain verified! Length: {}", chain.len());\n    \n    Ok(())\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"./core",children:"Core API Overview"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"./cryptographic-operations",children:"Cryptographic Operations"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"./wire-format-api",children:"Wire Format"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"./error-handling",children:"Error Handling"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>o});var l=i(6540);const a={},r=l.createContext(a);function s(e){const n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);