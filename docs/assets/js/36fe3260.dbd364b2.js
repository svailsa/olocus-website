"use strict";(globalThis.webpackChunkolocus_docs=globalThis.webpackChunkolocus_docs||[]).push([[9662],{6386:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"api/core","title":"Core API Reference","description":"Complete API reference for the olocus_core crate.","source":"@site/docs/api/core.md","sourceDirName":"api","slug":"/api/core","permalink":"/docs/api/core","draft":false,"unlisted":false,"editUrl":"https://codeberg.org/olocus/protocol/edit/main/docs/api/core.md","tags":[],"version":"current","lastUpdatedAt":1764937116000,"sidebarPosition":1,"frontMatter":{"id":"core","title":"Core API Reference","sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Scalability Roadmap","permalink":"/docs/architecture/scalability-roadmap"},"next":{"title":"Block Operations API","permalink":"/docs/api/block-operations"}}');var s=r(4848),t=r(8453);const l={id:"core",title:"Core API Reference",sidebar_position:1},o="Core API Reference",a={},c=[{value:"Block Operations",id:"block-operations",level:2},{value:"Creating Blocks",id:"creating-blocks",level:3},{value:"Verifying Blocks",id:"verifying-blocks",level:3},{value:"Wire Format",id:"wire-format",level:2},{value:"Encoding",id:"encoding",level:3},{value:"Decoding",id:"decoding",level:3},{value:"Available Formats",id:"available-formats",level:3},{value:"Cryptographic Operations",id:"cryptographic-operations",level:2},{value:"Signing",id:"signing",level:3},{value:"Hashing",id:"hashing",level:3},{value:"Encryption",id:"encryption",level:3},{value:"Measurement API",id:"measurement-api",level:2},{value:"Creating Measurements",id:"creating-measurements",level:3},{value:"Coordinate Conversions",id:"coordinate-conversions",level:3},{value:"BlockPayload Trait",id:"blockpayload-trait",level:2},{value:"Example Implementation",id:"example-implementation",level:3},{value:"Error Types",id:"error-types",level:2},{value:"Constants",id:"constants",level:2},{value:"Performance Targets",id:"performance-targets",level:2},{value:"Thread Safety",id:"thread-safety",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"core-api-reference",children:"Core API Reference"})}),"\n",(0,s.jsxs)(n.p,{children:["Complete API reference for the ",(0,s.jsx)(n.code,{children:"olocus_core"})," crate."]}),"\n",(0,s.jsx)(n.h2,{id:"block-operations",children:"Block Operations"}),"\n",(0,s.jsx)(n.h3,{id:"creating-blocks",children:"Creating Blocks"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"/// Generate a new Ed25519 key pair\npub fn generate_key() -> [u8; 32];\n\n/// Create a genesis (first) block\npub fn Block::genesis<P: BlockPayload>(\n    payload: P,\n    key: &[u8; 32],\n    timestamp: u64\n) -> Block<P>;\n\n/// Create the next block in a chain\npub fn Block::next<P: BlockPayload>(\n    previous: &Block<impl BlockPayload>,\n    payload: P,\n    key: &[u8; 32],\n    timestamp: u64\n) -> Result<Block<P>, Error>;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"verifying-blocks",children:"Verifying Blocks"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"/// Verify a single block\npub fn verify_block<P: BlockPayload>(\n    block: &Block<P>,\n    previous: Option<&Block<impl BlockPayload>>\n) -> Result<(), Error>;\n\n/// Verify an entire chain\npub fn verify_chain<P: BlockPayload>(\n    chain: &[Block<P>]\n) -> Result<(), Error>;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"wire-format",children:"Wire Format"}),"\n",(0,s.jsx)(n.h3,{id:"encoding",children:"Encoding"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"/// Create a wire format with specific encoding and compression\nlet format = WireFormat::new(\n    EncodingFormat::MessagePack,\n    CompressionMethod::Zstd\n);\n\n/// Encode a block\nlet bytes = format.encode(&block)?;\n\n/// Encode with default settings (JSON, no compression)\nlet bytes = WireFormat::json().encode(&block)?;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"decoding",children:"Decoding"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"/// Decode a block\nlet block: Block<MyPayload> = format.decode(&bytes)?;\n\n/// Auto-detect format from bytes\nlet block = WireFormat::decode_auto(&bytes)?;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"available-formats",children:"Available Formats"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Encoding"}),(0,s.jsx)(n.th,{children:"Compression"}),(0,s.jsx)(n.th,{children:"Content-Type"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Binary"}),(0,s.jsx)(n.td,{children:"None"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"application/x-olocus"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Binary"}),(0,s.jsx)(n.td,{children:"Zstd"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"application/x-olocus+zstd"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Binary"}),(0,s.jsx)(n.td,{children:"LZ4"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"application/x-olocus+lz4"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Binary"}),(0,s.jsx)(n.td,{children:"Gzip"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"application/x-olocus+gzip"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"JSON"}),(0,s.jsx)(n.td,{children:"None"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"application/json"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"JSON"}),(0,s.jsx)(n.td,{children:"Zstd"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"application/json+zstd"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"MessagePack"}),(0,s.jsx)(n.td,{children:"None"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"application/msgpack"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Protobuf"}),(0,s.jsx)(n.td,{children:"None"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"application/x-protobuf"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"SSZ"}),(0,s.jsx)(n.td,{children:"None"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"application/ssz"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"cryptographic-operations",children:"Cryptographic Operations"}),"\n",(0,s.jsx)(n.h3,{id:"signing",children:"Signing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"/// Sign a message with Ed25519\npub fn sign(\n    message: &[u8],\n    secret_key: &[u8; 32]\n) -> [u8; 64];\n\n/// Verify a signature\npub fn verify_signature(\n    message: &[u8],\n    signature: &[u8; 64],\n    public_key: &[u8; 32]\n) -> bool;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"hashing",children:"Hashing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"/// Compute SHA-256 hash\npub fn hash(data: &[u8]) -> [u8; 32];\n\n/// Compute block hash\npub fn Block::hash(&self) -> [u8; 32];\n"})}),"\n",(0,s.jsx)(n.h3,{id:"encryption",children:"Encryption"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"/// Generate X25519 key pair\npub fn generate_x25519_keypair() -> ([u8; 32], [u8; 32]);\n\n/// Perform X25519 key agreement\npub fn x25519_agreement(\n    secret: &[u8; 32],\n    peer_public: &[u8; 32]\n) -> [u8; 32];\n\n/// Encrypt with AES-256-GCM\npub fn encrypt_aes256gcm(\n    plaintext: &[u8],\n    key: &[u8; 32],\n    nonce: &[u8; 12]\n) -> Vec<u8>;\n\n/// Decrypt with AES-256-GCM\npub fn decrypt_aes256gcm(\n    ciphertext: &[u8],\n    key: &[u8; 32],\n    nonce: &[u8; 12]\n) -> Result<Vec<u8>, Error>;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"measurement-api",children:"Measurement API"}),"\n",(0,s.jsx)(n.h3,{id:"creating-measurements",children:"Creating Measurements"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"use olocus_core::{Measurement, Value, Uncertainty, Provenance};\n\nlet measurement = Measurement {\n    value: Value::Float(23.5),\n    uncertainty: Uncertainty::Gaussian { std_dev: 0.1 },\n    provenance: Provenance::default(),\n    validity: ValidityWindow::perpetual(),\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinate-conversions",children:"Coordinate Conversions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"/// Convert degrees to fixed-point\npub fn Coordinate::latitude_to_fixed(degrees: f64) -> i64;\npub fn Coordinate::longitude_to_fixed(degrees: f64) -> i64;\n\n/// Convert fixed-point to degrees\npub fn Coordinate::fixed_to_latitude(fixed: i64) -> f64;\npub fn Coordinate::fixed_to_longitude(fixed: i64) -> f64;\n\n/// Calculate distance in meters\npub fn Coordinate::haversine_distance(\n    lat1: i64, lon1: i64,\n    lat2: i64, lon2: i64\n) -> f64;\n\n/// Calculate bearing in degrees\npub fn Coordinate::bearing(\n    lat1: i64, lon1: i64,\n    lat2: i64, lon2: i64\n) -> f64;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"blockpayload-trait",children:"BlockPayload Trait"}),"\n",(0,s.jsx)(n.p,{children:"Implement this trait to create custom payload types:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"pub trait BlockPayload: Send + Sync {\n    /// Serialize payload to bytes\n    fn to_bytes(&self) -> Vec<u8>;\n    \n    /// Deserialize payload from bytes\n    fn from_bytes(bytes: &[u8]) -> Result<Self, Error>\n    where\n        Self: Sized;\n    \n    /// Unique payload type identifier (0x0000-0xFFFF)\n    fn payload_type() -> u32;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"example-implementation",children:"Example Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"#[derive(Serialize, Deserialize)]\npub struct MyData {\n    pub id: String,\n    pub value: i64,\n}\n\nimpl BlockPayload for MyData {\n    fn to_bytes(&self) -> Vec<u8> {\n        serde_json::to_vec(self).unwrap()\n    }\n    \n    fn from_bytes(bytes: &[u8]) -> Result<Self, Error> {\n        serde_json::from_slice(bytes)\n            .map_err(|e| Error::Deserialization(e.to_string()))\n    }\n    \n    fn payload_type() -> u32 {\n        0x1234  // Your unique type ID\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-types",children:"Error Types"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"pub enum Error {\n    // Cryptographic errors\n    InvalidSignature,\n    InvalidPublicKey,\n    InvalidSecretKey,\n    \n    // Chain errors\n    BrokenChain,\n    InvalidIndex,\n    InvalidPreviousHash,\n    \n    // Timestamp errors\n    TimestampTooOld,\n    TimestampTooFarInFuture,\n    TimestampNotMonotonic,\n    \n    // Serialization errors\n    Serialization(String),\n    Deserialization(String),\n    \n    // Compression errors\n    CompressionFailed(String),\n    DecompressionFailed(String),\n    \n    // General errors\n    InvalidPayloadType,\n    PayloadTooLarge,\n    UnsupportedVersion,\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"constants",children:"Constants"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"/// Protocol version\npub const VERSION: u16 = 0x0105;\n\n/// Maximum payload size (16 MiB)\npub const MAX_PAYLOAD_SIZE: usize = 16_777_216;\n\n/// Maximum future timestamp drift (5 minutes)\npub const MAX_FUTURE_DRIFT: i64 = 300;\n\n/// Maximum block age (24 hours)\npub const MAX_BLOCK_AGE: i64 = 86_400;\n\n/// Coordinate precision (degrees \xd7 10^7)\npub const COORDINATE_SCALE: i64 = 10_000_000;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance-targets",children:"Performance Targets"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Operation"}),(0,s.jsx)(n.th,{children:"Target Time"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Block creation"}),(0,s.jsx)(n.td,{children:"< 1ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Block verification"}),(0,s.jsx)(n.td,{children:"< 1ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"SHA-256 hash"}),(0,s.jsx)(n.td,{children:"< 100\u03bcs"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Ed25519 sign"}),(0,s.jsx)(n.td,{children:"< 500\u03bcs"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Ed25519 verify"}),(0,s.jsx)(n.td,{children:"< 1ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Wire encoding"}),(0,s.jsx)(n.td,{children:"< 2ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Wire decoding"}),(0,s.jsx)(n.td,{children:"< 2ms"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"thread-safety",children:"Thread Safety"}),"\n",(0,s.jsxs)(n.p,{children:["All core types implement ",(0,s.jsx)(n.code,{children:"Send + Sync"})," and are safe to use across threads:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"// Safe to share across threads\nlet block: Arc<Block<MyPayload>> = Arc::new(block);\nlet handle = thread::spawn(move || {\n    verify_block(&block, None)\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"../extensions/overview",children:"Explore Extensions API"})," - Extension-specific APIs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"../extensions/overview",children:"Explore Extensions API"})," - Extension-specific APIs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"../extensions/creating-extensions",children:"Creating Custom Extensions"})," - Build your own extensions"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>o});var i=r(6540);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);